
<div class="o-techdocs-container">
	<div class="o-techdocs-layout">

		<div class="o-techdocs-sidebar">
			{{>navigation}}
		</div>

		<div class="o-techdocs-main o-techdocs-content">

			<h1>Ingestion Queue Endpoints</h1>

			<p>
				The ingestion queue endpoints are used to view and manage the queue of repositories
				to be added to the service. They respond and deal with one of the following entities:
			</p>

			<h2 id="entities">Entities</h2>

			<h3 id="entity-ingestion">Ingestion Entity</h3>

			<p>
				Ingestion entities represent individual repositories in the queue, which are waiting
				to be ingested or are currently being ingested. As JSON they look like this:
			</p>

			<pre><code class="json">{
	// A unique identifier for the ingestion
	"id": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx",

	// The repository and tag which will be ingested to create a
	// new version in the database
	"repo": {
		"url": "https://github.com/Financial-Times/example",
		"tag": "v1.0.0"
	},

	// The progress that has been made so far in ingesting this
	// repository and tag
	"progress": {

		// Whether this item is currently being ingested
		"isInProgress": false,

		// The time that the ingestion process was started, either
		// null when it is not in progress, or a date string if it is
		"startTime": null,

		// How many attempts have been made to ingest this
		// repository and tag combination
		"attempts": 0

	},

	// When the ingestion was created
	"created": "2017-11-08T12:13:00.000Z",

	// When the ingestion was last updated
	"lastUpdated": "2017-11-08T12:13:00.000Z"
}</code></pre>


			<h2 id="get-v1-queue">Get the full queue</h2>

			<p>
				Get a list of all current ingestions in the queue as an array. This endpoint
				responds with an array of <a href="#entity-ingestion">Ingestion entities</a>. This
				endpoint requires the <code>READ</code> permission.
			</p>

			<h3>Request</h3>

			<div class="o-techdocs-table-wrapper">
				<table>
					<tbody>
						<tr>
							<th scope="row">Method</th>
							<td>
								<code>GET</code>
							</td>
						</tr>
						<tr>
							<th scope="row">Path</th>
							<td>
								<code>/v1/queue</code>
							</td>
						</tr>
						<tr>
							<th scope="row">Headers</th>
							<td>
								<dl>
									<dt>X-Api-Key</dt>
									<dd>See <a href="{{basePath}}v1/docs/api/authentication">authentication docs</a></dd>
									<dt>X-Api-Secret</dt>
									<dd>See <a href="{{basePath}}v1/docs/api/authentication">authentication docs</a></dd>
								</dl>
							</td>
						</tr>
					</tbody>
				</table>
			</div>

			<h3>Response</h3>

			<div class="o-techdocs-table-wrapper">
				<table>
					<tbody>
						<tr>
							<th scope="row">Status</th>
							<td>
								<code>200</code> on success<br/>
								<code>401</code> if authentication failed<br/>
								<code>403</code> if authorization failed
							</td>
						</tr>
						<tr>
							<th scope="row">Headers</th>
							<td>
								<dl>
									<dt>Content-Type</dt>
									<dd>
										<code>application/json</code> on success<br/>
										<code>text/html</code> on error
									</dd>
								</dl>
							</td>
						</tr>
						<tr>
							<th scope="row">Body</th>
							<td>
								<pre><code class="json">{
	"queue": [
		{
			// Ingestion entity
		}
	]
}</code></pre>
								<a href="#entity-ingestion">(documentation on Ingestion entities)</a>
							</td>
						</tr>
					</tbody>
				</table>
			</div>

			<h3>Example <code>curl</code> command:</h3>

			<pre><code class="bash">curl \
	-H 'X-Api-Key: XXXXXX' -H 'X-Api-Secret: XXXXXX' \
	https://origami-repo-data.ft.com/v1/queue</code></pre>


			<h2 id="get-v1-queue-(id)">Get an ingestion</h2>

			<p>
				Get a single ingestion in the queue by ID. This endpoint responds with a
				<a href="#entity-ingestion">Ingestion entity</a>. This endpoint requires the
				<code>READ</code> permission.
			</p>

			<h3>Request</h3>

			<div class="o-techdocs-table-wrapper">
				<table>
					<tbody>
						<tr>
							<th scope="row">Method</th>
							<td>
								<code>GET</code>
							</td>
						</tr>
						<tr>
							<th scope="row">Path</th>
							<td>
								<code>/v1/queue/<var>:ingestion-id</var></code><br/>
								(where <var>:ingestion-id</var> is the unique identifier for a
								<a href="#entity-ingestion">Ingestion</a>)
							</td>
						</tr>
						<tr>
							<th scope="row">Headers</th>
							<td>
								<dl>
									<dt>X-Api-Key</dt>
									<dd>See <a href="{{basePath}}v1/docs/api/authentication">authentication docs</a></dd>
									<dt>X-Api-Secret</dt>
									<dd>See <a href="{{basePath}}v1/docs/api/authentication">authentication docs</a></dd>
								</dl>
							</td>
						</tr>
					</tbody>
				</table>
			</div>

			<h3>Response</h3>

			<div class="o-techdocs-table-wrapper">
				<table>
					<tbody>
						<tr>
							<th scope="row">Status</th>
							<td>
								<code>200</code> on success<br/>
								<code>401</code> if authentication failed<br/>
								<code>403</code> if authorization failed<br/>
								<code>404</code> if an ingestion matching <var>:ingestion-id</var> does not exist
							</td>
						</tr>
						<tr>
							<th scope="row">Headers</th>
							<td>
								<dl>
									<dt>Content-Type</dt>
									<dd>
										<code>application/json</code> on success<br/>
										<code>text/html</code> on error
									</dd>
								</dl>
							</td>
						</tr>
						<tr>
							<th scope="row">Body</th>
							<td>
								<pre><code class="json">{
	"ingestion": {
		// Ingestion entity
	}
}</code></pre>
								<a href="#entity-ingestion">(documentation on Ingestion entities)</a>
							</td>
						</tr>
					</tbody>
				</table>
			</div>

			<h3>Example <code>curl</code> command:</h3>

			<pre><code class="bash">curl \
	-H 'X-Api-Key: XXXXXX' -H 'X-Api-Secret: XXXXXX' \
	https://origami-repo-data.ft.com/v1/queue/XXXXXX</code></pre>


			<h2 id="post-v1-queue">Add an ingestion to the queue</h2>

			<p>
				Create a new ingestion and add it to the queue. This endpoint accepts
				ingestion details and responds with a newly created
				<a href="#entity-ingestion">Ingestion entity</a>. This endpoint requires the
				<code>WRITE</code> permission.
			</p>

			<h3>Request</h3>

			<div class="o-techdocs-table-wrapper">
				<table>
					<tbody>
						<tr>
							<th scope="row">Method</th>
							<td>
								<code>POST</code>
							</td>
						</tr>
						<tr>
							<th scope="row">Path</th>
							<td>
								<code>/v1/queue</code>
							</td>
						</tr>
						<tr>
							<th scope="row">Headers</th>
							<td>
								<dl>
									<dt>Content-Type</dt>
									<dd><code>application/json</code></dd>
									<dt>X-Api-Key</dt>
									<dd>See <a href="{{basePath}}v1/docs/api/authentication">authentication docs</a></dd>
									<dt>X-Api-Secret</dt>
									<dd>See <a href="{{basePath}}v1/docs/api/authentication">authentication docs</a></dd>
								</dl>
							</td>
						</tr>
						<tr>
							<th scope="row">Body</th>
							<td>
								<pre><code class="json">{
	// The GitHub repository URL to ingest (required)
	"url": "https://github.com/Financial-Times/example",

	// The GitHub repository tag to ingest (required)
	"tag": "v1.0.0"
}</code></pre>
							</td>
						</tr>
					</tbody>
				</table>
			</div>

			<h3>Response</h3>

			<div class="o-techdocs-table-wrapper">
				<table>
					<tbody>
						<tr>
							<th scope="row">Status</th>
							<td>
								<code>201</code> on success<br/>
								<code>400</code> if the request data is invalid or malformed<br/>
								<code>401</code> if authentication failed<br/>
								<code>403</code> if authorization failed
							</td>
						</tr>
						<tr>
							<th scope="row">Headers</th>
							<td>
								<dl>
									<dt>Content-Type</dt>
									<dd>
										<code>application/json</code> on success<br/>
										<code>text/html</code> on error
									</dd>
								</dl>
							</td>
						</tr>
						<tr>
							<th scope="row">Body</th>
							<td>
								<pre><code class="json">{
	"ingestion": {
		// Ingestion entity
	}
}</code></pre>
								<a href="#entity-ingestion">(documentation on Ingestion entities)</a>
							</td>
						</tr>
					</tbody>
				</table>
			</div>

			<h3>Example <code>curl</code> command:</h3>

			<pre><code class="bash">curl -X POST \
	-H 'Content-Type: application/json' -H 'X-Api-Key: XXXXXX' -H 'X-Api-Secret: XXXXXX' \
	-d '{"url": "https://github.com/Financial-Times/example", "tag": "v1.0.0"}' \
	https://origami-repo-data.ft.com/v1/queue</code></pre>


			<h2 id="delete-v1-queue-(id)">Delete an ingestion</h2>

			<p>
				Delete a single ingestion from the queue by ID, preventing that repo/tag combination
				from being ingested. This endpoint requires the <code>ADMIN</code> permission.
			</p>

			<h3>Request</h3>

			<div class="o-techdocs-table-wrapper">
				<table>
					<tbody>
						<tr>
							<th scope="row">Method</th>
							<td>
								<code>DELETE</code>
							</td>
						</tr>
						<tr>
							<th scope="row">Path</th>
							<td>
								<code>/v1/queue/<var>:ingestion-id</var></code><br/>
								(where <var>:ingestion-id</var> is the unique identifier for a
								<a href="#entity-ingestion">Ingestion</a>)
							</td>
						</tr>
						<tr>
							<th scope="row">Headers</th>
							<td>
								<dl>
									<dt>X-Api-Key</dt>
									<dd>See <a href="{{basePath}}v1/docs/api/authentication">authentication docs</a></dd>
									<dt>X-Api-Secret</dt>
									<dd>See <a href="{{basePath}}v1/docs/api/authentication">authentication docs</a></dd>
								</dl>
							</td>
						</tr>
					</tbody>
				</table>
			</div>

			<h3>Response</h3>

			<div class="o-techdocs-table-wrapper">
				<table>
					<tbody>
						<tr>
							<th scope="row">Status</th>
							<td>
								<code>204</code> on success<br/>
								<code>401</code> if authentication failed<br/>
								<code>403</code> if authorization failed<br/>
								<code>404</code> if an ingestion matching <var>:ingestion-id</var> does not exist
							</td>
						</tr>
						<tr>
							<th scope="row">Headers</th>
							<td>
								<dl>
									<dt>Content-Type</dt>
									<dd>
										Empty on success<br/>
										<code>text/html</code> on error
									</dd>
								</dl>
							</td>
						</tr>
						<tr>
							<th scope="row">Body</th>
							<td>
								Empty
							</td>
						</tr>
					</tbody>
				</table>
			</div>

			<h3>Example <code>curl</code> command:</h3>

			<pre><code class="bash">curl -X DELETE \
	-H 'X-Api-Key: XXXXXX' -H 'X-Api-Secret: XXXXXX' \
	https://origami-repo-data.ft.com/v1/queue/XXXXXX</code></pre>

		</div>

	</div>
</div>
